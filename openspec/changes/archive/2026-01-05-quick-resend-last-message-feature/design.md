## Context

AIPut 移动端 Web 界面当前提供基本的文本输入和发送功能，包括：
- 文本输入框（textarea）
- 发送和清空按钮
- 手势操作（上滑发送、下滑清空）
- 输入历史记录（保存在侧边栏，localStorage 存储最近10条）

用户在以下场景中体验不佳：
1. 网络临时故障后需要重新输入或从历史记录手动复制
2. 快速重复发送相同文本时操作繁琐
3. 误操作后恢复成本高

### Constraints

- 必须兼容现有功能和样式
- 不能影响现有手势操作
- 必须在移动端浏览器中正常工作
- 使用 localStorage 作为持久化存储

### Stakeholders

- 移动端用户：需要快速重发功能提升效率
- 开发团队：需要代码简单、可维护

## Goals / Non-Goals

### Goals

- 提供一键重发上次发送内容的功能
- 在输入框上方显示直观的重发区域
- 自动保存和恢复上次发送的内容
- 保持与现有 UI 风格一致

### Non-Goals

- 不支持历史记录选择（已有侧边栏历史功能）
- 不支持编辑重发内容（用户可在输入框修改）
- 不影响现有侧边栏历史记录功能

## Decisions

### 决策 1：重发区域位置

**选择**：将重发区域放置在文本输入框正上方

**理由**：
- 靠近输入区域，用户视线自然流动
- 不干扰头部操作区域
- 符合用户"先看历史、再输入"的心智模型

**替代方案**：
- 放在头部按钮区域：已满，空间紧张
- 放在输入框下方：不在用户视线焦点，易被忽略

### 决策 2：状态存储策略

**选择**：使用独立的 `lastSentContent` localStorage 字段

**理由**：
- 与现有的 `typeHistory` 数组（10条历史）解耦
- 简化读取逻辑，只需读取单个字符串
- 语义清晰，专门用于快速重发

**替代方案**：
- 复用 `typeHistory[0]`：耦合度高，历史记录清空会影响重发功能
- 仅内存存储：页面刷新后丢失，体验差

### 决策 3：触发更新时机

**选择**：每次调用发送 API 后更新（无论成功与否）

**理由**：
- 失败后用户最需要重发功能
- 符合用户"上次尝试发送的内容"的预期

**替代方案**：
- 仅成功后更新：失败场景无法使用重发，体验差

### 决策 4：UI 样式一致性

**选择**：重发按钮复用主发送按钮样式

**理由**：
- 视觉一致性，用户能快速识别功能
- 减少样式代码重复

**实现细节**：
- 预览文本使用灰色、较小字体表示历史状态
- 单行显示 + 省略号，避免占用过多垂直空间

## Risks / Trade-offs

### Risk 1：占用垂直空间

**风险**：重发区域会减少输入框可用空间

**缓解措施**：
- 重发区域紧凑设计（高度约 40px）
- 仅在有历史内容时显示
- 响应式设计，小屏幕下适当缩小

### Risk 2：与现有手势冲突

**风险**：重发区域可能干扰上滑/下滑手势

**缓解措施**：
- 重发区域不绑定触摸事件
- 手势事件仅绑定在 textarea 上（现有实现）

### Risk 3：长文本预览

**风险**：过长文本在预览区显示不完整

**缓解措施**：
- 单行显示 + `text-overflow: ellipsis`
- 用户可点击预览区查看完整内容（可选增强）

## Migration Plan

### Implementation Steps

1. 修改 `site/index.html`：添加重发区域 HTML 结构
2. 修改 `site/app.js`：添加状态管理和重发逻辑
3. 修改 `site/style.css`：添加重发区域样式

### Rollback Plan

如有问题，可通过以下步骤回滚：
1. 删除添加的 HTML 结构
2. 移除 JavaScript 中的相关代码
3. 删除 CSS 中的相关样式
4. 清理 localStorage 中的 `lastSentContent`（可选）

### Backward Compatibility

- 完全向下兼容，不影响现有功能
- localStorage 新增字段不影响旧版本
- 无需后端变更

## Open Questions

无
